name: Basic Windows Connect

on:
  workflow_dispatch:

jobs:
  connect:
    runs-on: self-hosted
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run connect playbook (prints Connected successfully)
        env:
          WINDOWS_USER: "Administrator"
          WINDOWS_PASSWORD: "YourNewPassword@123"
        run: |
          echo "Effective username: ${WINDOWS_USER}"
          ansible-playbook -i inventory/hosts.ini playbooks/win-ping.yml \
            -e "ansible_user=${WINDOWS_USER} \
                ansible_password=${WINDOWS_PASSWORD} \
                ansible_connection=winrm \
                ansible_winrm_transport=ntlm \
                ansible_port=5985 \
                ansible_winrm_scheme=http \
                ansible_winrm_server_cert_validation=ignore \
                ansible_winrm_operation_timeout_sec=60 \
                ansible_winrm_read_timeout_sec=120" -vvv
